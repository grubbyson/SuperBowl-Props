<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bronny's Super Bowl 60 Prop Bet Bonanza</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="app"></div>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCrkw9XPxCQhQpongDWefVQKEW60YHZBV4",
            authDomain: "superbowl-props-website.firebaseapp.com",
            databaseURL: "https://superbowl-props-website-default-rtdb.firebaseio.com",
            projectId: "superbowl-props-website",
            storageBucket: "superbowl-props-website.firebasestorage.app",
            messagingSenderId: "189905821964",
            appId: "1:189905821964:web:26b76847336467d805e929"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        let app = {
            mode: 'collect',
            questions: [],
            responses: [],
            answers: {},
            name: '',
            currentResp: {},
            isAdmin: false,
            pwd: '',
            adminPwd: '',
            showPwdModal: false,
            selected: null,
            showThanks: false
        };

        function save(path, data) {
            db.ref('quiz/' + path).set(data);
        }

        function load() {
            db.ref('quiz').once('value', snap => {
                const d = snap.val();
                if (d) {
                    app.questions = d.questions || [];
                    app.responses = d.responses || [];
                    app.answers = d.answers || {};
                    app.adminPwd = d.password || '';
                }
                draw();
            });
        }

        function draw() {
            const root = document.getElementById('app');
            let h = '<div class="p-4 max-w-4xl mx-auto">';
            
            if (app.showThanks) {
                h += '<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onclick="if(event.target===this){app.showThanks=false;draw();}"><div class="bg-white rounded-lg shadow-2xl p-8 max-w-md mx-4 text-center"><div class="text-6xl mb-4">üéâ</div><h2 class="text-2xl font-bold mb-4">Thank you for submitting your picks!</h2><p class="text-lg mb-6">Please pay your entry fee to Bronson.</p><button onclick="app.showThanks=false;draw()" class="w-full py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">Close</button></div></div>';
            }
            
            if (app.showPwdModal) {
                h += '<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onclick="if(event.target===this){app.showPwdModal=false;draw();}"><div class="bg-white rounded-lg shadow-2xl p-8 max-w-md mx-4"><h2 class="text-2xl font-bold mb-4">' + (app.adminPwd ? 'Admin Login' : 'Set Admin Password') + '</h2><p class="text-gray-600 mb-6">' + (app.adminPwd ? 'Enter your admin password' : 'Create a password to protect the quiz') + '</p><input type="password" id="pwdInput" class="w-full px-4 py-3 border rounded-lg mb-4" placeholder="Password" onkeyup="if(event.key===\'Enter\'){' + (app.adminPwd ? 'doLogin()' : 'setPassword()') + '}"><div class="flex gap-2"><button onclick="' + (app.adminPwd ? 'doLogin()' : 'setPassword()') + '" class="flex-1 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">' + (app.adminPwd ? 'Login' : 'Set Password') + '</button><button onclick="app.showPwdModal=false;draw()" class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300">Cancel</button></div></div></div>';
            }
            
            h += '<div class="bg-white rounded-lg shadow-xl p-6"><div class="flex justify-between items-center mb-4 flex-wrap gap-2"><h1 class="text-2xl md:text-3xl font-bold">Bronny\'s Super Bowl 60 Prop Bet Bonanza</h1>';
            h += app.isAdmin ? '<button onclick="app.isAdmin=false;app.mode=\'collect\';draw()" class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm hover:bg-gray-700">Logout</button>' : '<button onclick="app.showPwdModal=true;draw()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">Admin Login</button>';
            h += '</div><div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-lg p-4 mb-6"><p class="text-gray-800 text-sm md:text-base leading-relaxed"><strong class="text-lg block mb-2">Welcome Friends!</strong>This year, we are doing it differently. Everyone will be competing against each other for most picks correct. There will be prizes paid out to 1st, 2nd, 3rd, and LAST PLACE (Possibly more depending on number of entries, similar to my golf pools). Tiebreaker will be the last question - closest to the number, doesn\'t matter if it\'s higher or lower.</p></div>';
            
            h += '<div class="flex flex-wrap gap-2 mb-6">';
            if (app.isAdmin) h += '<button onclick="app.mode=\'setup\';draw()" class="px-4 py-2 rounded-lg font-medium text-sm ' + (app.mode === 'setup' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700') + '">‚öôÔ∏è Setup</button>';
            h += '<button onclick="app.mode=\'collect\';draw()" class="px-4 py-2 rounded-lg font-medium text-sm ' + (app.mode === 'collect' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700') + '">üë• Make Picks</button>';
            if (app.isAdmin) h += '<button onclick="app.mode=\'grade\';draw()" class="px-4 py-2 rounded-lg font-medium text-sm ' + (app.mode === 'grade' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700') + '">üèÜ Set Answers</button>';
            h += '<button onclick="app.mode=\'results\';draw()" class="px-4 py-2 rounded-lg font-medium text-sm ' + (app.mode === 'results' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700') + '">üìä Results</button>';
            h += '</div>';
            
            if (app.mode === 'setup') h += drawSetup();
            else if (app.mode === 'collect') h += drawCollect();
            else if (app.mode === 'grade') h += drawGrade();
            else if (app.mode === 'results') h += drawResults();
            
            h += '</div></div>';
            root.innerHTML = h;
        }

        function drawSetup() {
            let h = '<div><div class="flex justify-between mb-4"><h2 class="text-2xl font-bold">Create Quiz</h2><button onclick="if(confirm(\'Reset all?\'))resetAll()" class="px-3 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600">Reset All</button></div>';
            app.questions.forEach((q, i) => {
                h += '<div class="bg-gray-50 rounded-lg p-4 mb-4"><div class="flex gap-2 mb-3 flex-wrap"><input type="text" value="' + esc(q.text) + '" oninput="app.questions[' + i + '].text=this.value;save(\'questions\',app.questions)" placeholder="Question ' + (i + 1) + '" class="flex-1 min-w-[200px] px-3 py-2 border rounded-lg"><select onchange="app.questions[' + i + '].type=this.value;save(\'questions\',app.questions);draw()" class="px-3 py-2 border rounded-lg"><option value="multiple-choice" ' + (q.type === 'multiple-choice' ? 'selected' : '') + '>Multiple Choice</option><option value="text-input" ' + (q.type === 'text-input' ? 'selected' : '') + '>Text Input</option></select><button onclick="app.questions.splice(' + i + ',1);save(\'questions\',app.questions);draw()" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">üóëÔ∏è</button></div>';
                if (q.type === 'multiple-choice') {
                    h += '<div class="space-y-2">';
                    q.options.forEach((opt, j) => {
                        h += '<div class="flex gap-2"><span class="text-gray-500 font-medium">' + String.fromCharCode(65 + j) + '.</span><input type="text" value="' + esc(opt) + '" oninput="app.questions[' + i + '].options[' + j + ']=this.value;save(\'questions\',app.questions)" class="flex-1 px-3 py-2 border rounded-lg">';
                        if (q.options.length > 2) h += '<button onclick="app.questions[' + i + '].options.splice(' + j + ',1);save(\'questions\',app.questions);draw()" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">üóëÔ∏è</button>';
                        h += '</div>';
                    });
                    h += '</div><button onclick="app.questions[' + i + '].options.push(\'\');save(\'questions\',app.questions);draw()" class="mt-2 px-3 py-1 bg-gray-200 rounded-lg text-sm hover:bg-gray-300">+ Add Option</button>';
                } else {
                    h += '<div class="text-sm text-gray-600 italic">Users will type their answer</div>';
                }
                h += '</div>';
            });
            h += '<button onclick="addQ()" class="w-full py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700">‚ûï Add Question</button></div>';
            return h;
        }

        function drawCollect() {
            if (app.questions.length === 0) return '<div><h2 class="text-2xl font-bold mb-4">Make Your Picks</h2><div class="text-center py-12"><p class="text-gray-500 text-lg">No questions available yet. Check back soon!</p></div></div>';
            let h = '<div><h2 class="text-2xl font-bold mb-4">Make Your Picks</h2><div class="mb-8 bg-blue-50 p-4 rounded-lg"><label class="block text-lg font-bold mb-2">Your Name *</label><input type="text" id="nameInput" class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg text-lg" placeholder="Enter your full name"></div>';
            app.questions.forEach((q, i) => {
                h += '<div class="mb-6"><h3 class="font-bold mb-3">' + (i + 1) + '. ' + esc(q.text) + '</h3>';
                if (q.type === 'text-input') {
                    h += '<input type="text" id="resp' + q.id + '" class="w-full px-4 py-3 border rounded-lg" placeholder="Type your answer">';
                } else {
                    h += '<div class="space-y-2">';
                    q.options.forEach((opt, j) => {
                        h += '<label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100"><input type="radio" name="q' + q.id + '" value="' + j + '" class="w-4 h-4"><span>' + String.fromCharCode(65 + j) + '. ' + esc(opt) + '</span></label>';
                    });
                    h += '</div>';
                }
                h += '</div>';
            });
            h += '<button onclick="submit()" class="w-full py-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700">Submit Picks</button><div class="mt-6 p-4 bg-blue-50 rounded-lg"><p class="text-sm"><strong>' + app.responses.length + '</strong> pick' + (app.responses.length !== 1 ? 's' : '') + ' submitted so far</p></div></div>';
            return h;
        }

        function drawGrade() {
            let h = '<div><h2 class="text-2xl font-bold mb-4">Set Correct Answers</h2>';
            app.questions.forEach((q, i) => {
                const hasAns = app.answers[q.id] !== undefined && app.answers[q.id] !== '';
                h += '<div class="mb-6"><div class="flex justify-between mb-3"><h3 class="font-bold">' + (i + 1) + '. ' + esc(q.text) + '</h3>';
                if (hasAns) h += '<button onclick="delete app.answers[' + q.id + '];save(\'answers\',app.answers);draw()" class="px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200">üóëÔ∏è Clear</button>';
                h += '</div>';
                if (q.type === 'multiple-choice') {
                    h += '<div class="space-y-2">';
                    q.options.forEach((opt, j) => {
                        const sel = app.answers[q.id] === j;
                        h += '<label class="flex items-center gap-3 p-3 rounded-lg cursor-pointer ' + (sel ? 'bg-green-100 border-2 border-green-500' : 'bg-gray-50 hover:bg-gray-100') + '"><input type="radio" name="ans' + q.id + '" ' + (sel ? 'checked' : '') + ' onchange="app.answers[' + q.id + ']=' + j + ';save(\'answers\',app.answers);draw()" class="w-4 h-4"><span>' + String.fromCharCode(65 + j) + '. ' + esc(opt) + '</span></label>';
                    });
                    h += '</div>';
                } else {
                    h += '<input type="text" value="' + esc(app.answers[q.id] || '') + '" oninput="app.answers[' + q.id + ']=this.value;save(\'answers\',app.answers)" class="w-full px-4 py-3 border-2 border-green-300 rounded-lg bg-green-50" placeholder="Type the correct answer"><p class="text-sm text-gray-600 mt-2">Answers are case-insensitive</p>';
                }
                h += '</div>';
            });
            h += '</div>';
            return h;
        }

        function drawResults() {
            if (app.selected) return drawDetailed();
            let h = '<div><h2 class="text-2xl font-bold mb-4">Results & Scores</h2>';
            if (Object.keys(app.answers).length === 0) {
                h += '<p class="text-gray-600 mb-6">Answers have not been set yet. Check back during and after the Super Bowl!</p><div class="space-y-2">';
                app.responses.forEach(r => {
                    h += '<div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4"><div class="flex justify-between items-center gap-3"><h3 class="font-bold text-lg">' + esc(r.name) + '</h3><div class="flex items-center gap-3"><span class="text-gray-500 text-sm">Picks submitted</span>';
                    if (app.isAdmin) h += '<button onclick="delResp(' + r.id + ')" class="p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">üóëÔ∏è</button>';
                    h += '</div></div></div>';
                });
                h += '</div>';
            } else {
                const scores = calcScores();
                h += '<div class="space-y-3">';
                scores.forEach((r, i) => {
                    h += '<button onclick=\'selectResp(' + r.id + ')\' class="w-full bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 hover:from-blue-100 hover:to-indigo-100 text-left"><div class="flex justify-between items-center"><div><h3 class="font-bold text-lg">' + esc(r.name) + '</h3></div><div class="text-right"><div class="text-3xl font-bold text-blue-600">' + r.score + '</div><p class="text-sm text-gray-600">correct picks</p>' + (i === 0 && r.score > 0 ? '<span class="text-yellow-600 text-sm">üèÜ Top Score</span>' : '') + '</div></div></button>';
                });
                h += '</div><div class="mt-6 p-4 bg-gray-50 rounded-lg"><h3 class="font-bold mb-2">All Picks:</h3><p class="text-sm text-gray-600">Total: ' + app.responses.length + '</p></div>';
            }
            h += '</div>';
            return h;
        }

        function drawDetailed() {
            const scores = calcScores();
            const r = scores.find(s => s.id === app.selected);
            if (!r) {
                app.selected = null;
                draw();
                return '';
            }
            let h = '<div><div class="flex justify-between mb-4 gap-2 flex-wrap"><button onclick="app.selected=null;draw()" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">‚Üê Back</button>';
            if (app.isAdmin) h += '<button onclick="delResp(' + r.id + ')" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">üóëÔ∏è Delete</button>';
            h += '</div><div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 mb-6"><h3 class="text-2xl font-bold mb-2">' + esc(r.name) + '</h3><p class="text-gray-600">Correct Picks: ' + r.score + ' / ' + r.total + '</p></div>';
            r.details.forEach((d, i) => {
                h += '<div class="rounded-lg p-4 border-2 mb-4 ' + (d.isCorrect ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300') + '"><div class="flex justify-between mb-2 gap-2 flex-wrap"><h4 class="font-bold">' + (i + 1) + '. ' + esc(d.question.text) + '</h4><span class="px-3 py-1 rounded-full text-sm font-medium ' + (d.isCorrect ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800') + '">' + (d.isCorrect ? '‚úì Correct' : '‚úó Incorrect') + '</span></div>';
                if (d.question.type === 'text-input') {
                    h += '<div class="mt-3"><div><span class="text-sm font-medium text-gray-600">Your answer: </span><span class="' + (d.isCorrect ? 'text-green-700' : 'text-red-700') + '">' + esc(d.userAnswer || '(no answer)') + '</span></div>';
                    if (!d.isCorrect) h += '<div><span class="text-sm font-medium text-gray-600">Correct answer: </span><span class="text-green-700">' + esc(d.correctAnswer) + '</span></div>';
                    h += '</div>';
                } else {
                    h += '<div class="mt-3 space-y-2">';
                    d.question.options.forEach((opt, j) => {
                        const isUser = d.userAnswer === j;
                        const isCorr = d.correctAnswer === j;
                        h += '<div class="p-2 rounded ' + (isCorr ? 'bg-green-100 font-medium' : isUser ? 'bg-red-100' : 'bg-white') + '"><span class="mr-2">' + (isUser ? '‚Üí ' : '') + (isCorr ? '‚úì ' : '') + '</span>' + String.fromCharCode(65 + j) + '. ' + esc(opt) + (isUser && !isCorr ? ' (Your choice)' : '') + (isCorr ? ' (Correct answer)' : '') + '</div>';
                    });
                    h += '</div>';
                }
                h += '</div>';
            });
            h += '</div>';
            return h;
        }

        function esc(s) {
            return (s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;');
        }

        function addQ() {
            app.questions.push({id: Date.now(), text: '', type: 'multiple-choice', options: ['', '']});
            save('questions', app.questions);
            draw();
        }

        function submit() {
            const n = document.getElementById('nameInput').value.trim();
            if (!n) return alert('Please enter your name');
            const ans = {};
            app.questions.forEach(q => {
                if (q.type === 'text-input') {
                    const el = document.getElementById('resp' + q.id);
                    if (el) ans[q.id] = el.value;
                } else {
                    const sel = document.querySelector('input[name="q' + q.id + '"]:checked');
                    if (sel) ans[q.id] = parseInt(sel.value);
                }
            });
            app.responses.push({id: Date.now(), name: n, answers: ans, timestamp: new Date().toISOString()});
            save('responses', app.responses);
            app.showThanks = true;
            draw();
        }

        function selectResp(id) {
            app.selected = id;
            draw();
        }

        function calcScores() {
            return app.responses.map(r => {
                let correct = 0, total = 0;
                const details = [];
                app.questions.forEach(q => {
                    if (app.answers[q.id] !== undefined && app.answers[q.id] !== '') {
                        total++;
                        let isCorr = false;
                        if (q.type === 'text-input') {
                            const u = String(r.answers[q.id] || '').trim().toLowerCase();
                            const c = String(app.answers[q.id]).trim().toLowerCase();
                            isCorr = u === c;
                        } else {
                            isCorr = r.answers[q.id] === app.answers[q.id];
                        }
                        if (isCorr) correct++;
                        details.push({question: q, userAnswer: r.answers[q.id], correctAnswer: app.answers[q.id], isCorrect: isCorr});
                    }
                });
                return {id: r.id, name: r.name, score: correct, total: total, percentage: total > 0 ? Math.round((correct / total) * 100) : 0, details: details, timestamp: r.timestamp};
            }).sort((a, b) => b.percentage - a.percentage);
        }

        function resetAll() {
            app.questions = [];
            app.responses = [];
            app.answers = {};
            app.adminPwd = '';
            app.isAdmin = false;
            app.showPwdModal = true;
            app.mode = 'collect';
            db.ref('quiz').remove();
            draw();
        }

        function setPassword() {
            const p = document.getElementById('pwdInput').value.trim();
            if (!p) return alert('Please enter a password');
            app.adminPwd = p;
            app.isAdmin = true;
            app.showPwdModal = false;
            app.mode = 'setup';
            save('password', app.adminPwd);
            alert('Admin password set!');
            draw();
        }

        function doLogin() {
            const p = document.getElementById('pwdInput').value.trim();
            if (!p) return alert('Please enter a password');
            if (p === app.adminPwd) {
                app.isAdmin = true;
                app.showPwdModal = false;
                app.mode = 'setup';
                draw();
            } else {
                alert('Incorrect password');
            }
        }

        function delResp(id) {
            if (confirm('Delete this submission?')) {
                app.responses = app.responses.filter(r => r.id !== id);
                save('responses', app.responses);
                app.selected = null;
                draw();
            }
        }

        load();
    </script>
</body>
</html>